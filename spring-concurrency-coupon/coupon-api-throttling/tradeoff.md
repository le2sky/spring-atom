### 동시성 문제를 처리율 제한으로 해결하려는 접근 방식

#### 가설
처리율 제한 장치의 장점은 근본적으로 다음과 같다.

- DOS 공격에 의한 자원 고갈과 서버 과부하(사용자의 잘못된 사용 패턴, 봇 트래픽)를 방지한다.
- 서드파티 API 사용료 뻥튀기를 예방한다.

그렇다면 위와 같은 장점을 취하면서 동시성 문제를 해결하면 일석이조이지 않을까라는 생각을 했다.
아이디어는 다음과 같다.

- 기본적으로 동시성 문제는 서버의 동시 처리 능력과 연관이 있다.
- 극단적으로 생각했을 때, 서버의 스레드를 한 개로 제한하면 동시성 문제는 절대 발생하지 않는다.
- (가설) 특정 API의 동시 처리 능력을 희생시키면 동시성 문제가 발생하지 않고, 처리율 제한의 이점도 얻어갈 수 있을 것이다.

#### 적용

- 쿠폰 발급 API에 처리율 제한을 설정한다. (Guava 라이브러리의 처리율 제한 기능을 사용)
- 100개 스레드에 같은 사용자와 같은 쿠폰의 ID로 동시에 쿠폰 발급 API에 요청한다.
- 처리율 제한에 막히는 경우 429 (Too Many Request) 응답을 내려주고 요청을 무시한다.
- 사용자는 쿠폰을 단 한번만 발급할 수 있다.

#### 트레이드오프
