메일을 분산환경에서 스케줄링하여 보내야하는데, 어떻게 풀어볼 수 있을까?
스프링을 사용하는 분산환경에서 안전하게 스케줄링 로직을 수행하는 방법은 무엇이 있을까?

- mysql named lock이나 was 환경 변수에 was 번호와 전체 was 수를 입력하는 방법을 생각해봤다.
- 찾아보니, shedLock, 분산 스케줄링이라는 개념이 있는데.. 알아보자.

```
java -jar ./build/libs/subscribe-mail-send-0.0.1-SNAPSHOT.jar
```

### mysql v1

- 네임드락을 이용해서 각 프로세스마다 사용자를 순회하면서 분산 잠금을 획득한다.
- 4개 프로세스를 동시에 실행했을 때, 고루게 메일을 전송하는 것으로 보인다.
- 잠금 해제의 경우는 특정 시간에 lock 전용 커넥션을 획득항 release_lock을 수행한다.
- 만약 잠금을 바로바로 해제하는 경우에는 중복 발송이 발생할 수 있다.
- 모든 작업이 종료되었다고 판단되엇을 때, 잠금을 해제해야 한다.

#### 장점과 한계

- 모든 프로세스마다 고르게 메일 전송을 수행할 수 있다.
- 스케줄러 관점에서 한 프로세스에서만 전담하는 것보다 SPOF를 예방할 수 있다.
- (한계) 매 사용자마다 메일을 전송하기 위해서 잠금을 위한 네트워크 통신 비용이 발생한다.
